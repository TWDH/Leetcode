# 23.对守护线程的理解

- 守护线程：为所有非守护线程提供服务的线程；任何一个守护线程都是整个 **JVM中所有非守护线程的保姆**；
- 守护线程类似于整个进程的一个默默无闻的小喽喽；它的生死无关重要，它却依赖整个进程而运行；哪天其他线程结束了，没有要执行的了，程序就结束了，理都没理守护线程，就把它中断了；
- 注意： 由于守护线程的终止是自身无法控制的，因此千万不要把IO、File等重要操作逻辑分配给它；因为它不靠谱；
- 守护线程的作用是什么？
- 举例， GC垃圾回收线程：就是一个经典的守护线程，当我们的程序中不再有任何运行的 Thread,程序就不会再产生垃圾，垃圾回收器也就无事可，所以当垃圾回收线程是 JVM 上仅剩的线程时，垃圾回收线程会自动离开。它始终在低级别的状态中运行，用于实时监控和管理系统中的可回收资源。

应用场景：

1. 来为其它线程提供服务支持的情况；
2. 或者在任何情况下，程序结束时，这个线程必须正常且立刻关闭，就可以作为守护线程来使用；反之，如果一个正在执行某个操作的线程必须要正确地关闭掉否则就会出现不好的后果的话，那么这个线程就不能是守护线程，而是用户线程。通常都是些关键的事务，比方说，数据库录入或者更新，这些操作都是不能中断的。
   1. `thread.setDaemon(true)` 必须在 `thread.start()` 之前设置，否则会跑出一个 `IllegalThreadStateException` 异常。你不能把正在运行的常规线程设置为守护线程。
   2. 在 Daemon 线程中产生的新线程也是 Daemon 的。
   3. 守护线程不能用于去访问固有资源，比如读写操作或者计算逻辑。因为它会在任何时候甚至在一个操作的中间发生中断。
   4. Java自带的多线程框架，比如ExecutorService，会将守护线程转换为用户线程，所以如果要使用后台线程就不能用Java的线程池。