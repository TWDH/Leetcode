# 21.对线程安全的理解

### 不是线程安全、应该是内存安全，堆是共享内存，可以被所有线程访问

```
当多个线程访问一个对象时，如果不用进行额外的同步控制或其他的协调操作，调用这个对象的行为都可以获得正确的结果，我们就说这个对象是线程安全的
```

## 堆 

*  `进程` 和 `线程` 共有的空间，分 `全局堆` 和 `局部堆` 。
  * 全局堆就是所有没有分配的空间
  * 局部堆就是用户分配的空间
  * 堆在操作系统对 **进程初始化** 的时候分配，运行过程中也可以向系统要额外的堆，但是用完了要还给操作系统，要不然就是内存泄漏。

> * 在Java中，堆是Java虚拟机所管理的内存中最大的一块，是所有线程共享的一块内存区域，在虚拟机启动时创建。
> * 堆所存在的内存区域的 **唯一目的就是存放对象实例** ，几乎所有的 **对象实例** 以及 **数组** 都在这里分配内存。

## 栈

* 每个线程独有的，保存其 `运行状态` 和 `局部自动变量` 的。
* 栈在线程开始的时候初始化，每个线程的 **栈互相独立** ，因此，栈是 **线程安全** 的。
* 操作系统在切换线程的时候会 **自动切换栈**。
* 栈空间不需要在高级语言里面显式的分配和释放。



- 目前主流操作系统都是多任务的，即多个进程同时运行。为了保证安全，每个进程只能访问分配给自己的内存空间，而不能访问别的进程的，这是由操作系统保障的。
- 在每个进程的内存空间中都会有一块特殊的公共区域，通常称为堆（内存）。进程内的所有线程都可以访问到该区域，这就是造成问题的潜在原因。





















